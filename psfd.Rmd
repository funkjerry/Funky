---
title: "psfd"
author: "Wang"
date: "2020/9/25"
output: html_document
---

library(foreign)
library(ggplot2)
library(dplyr)
library(extrafont)
loadfonts("win")
wang <- read.spss("D:/satis/RIRR_1.sav")
wang2 <- as.data.frame(wang)

graph <-list()

### happy life
wang2 %>%
  drop_na(happy) %>% 
  group_by(scale) %>%
  summarise(count=mean(happy))->d1
wang2 %>%
  drop_na(life) %>% 
  group_by(scale) %>%
  summarise(count=mean(life))->d2
d1$count <- round(d1$count, digits=2)
d2$count <- round(d2$count, digits=2)
d1 <- data.frame(d1,category=c("H","H","H","H","H"))
d2 <- data.frame(d2,category=c("L","L","L","L","L"))
d3 <- rbind(d1,d2)
labelsx <- c("1953-64","1935-54","1964-76","1977-83","1984-91")

###health Shealth
wang2 %>%
  drop_na(health) %>% 
  group_by(scale) %>%
  summarise(count=mean(health))->d4
wang2 %>%
  drop_na(Shealth) %>% 
  group_by(scale) %>%
  summarise(count=mean(Shealth))->d5
d4$count <- round(d4$count, digits=2)
d5$count <- round(d5$count, digits=2)
d4 <- data.frame(d4,category=c("O","O","O","O","O"))
d5 <- data.frame(d5,category=c("S","S","S","S","S"))
d6 <- rbind(d4,d5)

### work family eco marry satis
wang2 %>%
  drop_na(work_satis) %>% 
  group_by(scale) %>%
  summarise(count=mean(work_satis))->d7
wang2 %>%
  drop_na(family_satis) %>% 
  group_by(scale) %>%
  summarise(count=mean(family_satis))->d8
wang2 %>%
  drop_na(eco_satis) %>% 
  group_by(scale) %>%
  summarise(count=mean(eco_satis))->d9
wang2 %>%
  drop_na(marry_satis) %>% 
  group_by(scale) %>%
  summarise(count=mean(marry_satis))->d10
d7$count <- round(d7$count, digits=2)
d8$count <- round(d8$count, digits=2)
d7 <- data.frame(d7,category=c("W","W","W","W","W"))
d8 <- data.frame(d8,category=c("F","F","F","F","F"))
d9$count <- round(d9$count, digits=2)
d10$count <- round(d10$count, digits=2)
d9 <- data.frame(d9,category=c("E","E","E","E","E"))
d10 <- data.frame(d10,category=c("M","M","M","M","M"))
d11 <- rbind(d7,d8,d9,d10)

save(
  d3,d6,d11,labelsx,
  file="psfddata.Rda")

### 作圖 d3
d3 %>%
  ggplot(aes(x=scale, y=count, group=category, color=category))+
  geom_line(linetype="solid", size=1)+
  geom_point(size=3)+
  geom_text(aes(label=count,
    vjust=1.5,hjust=0,alpha=1.2,
    fontface="bold"),
    show.legend = FALSE)+
  scale_x_discrete(labels=labelsx)+
  scale_color_discrete(
  labels=c("Happy","Life"))+
  theme(text=element_text(size=10, family="Comic Sans MS"),
  axis.text.x=element_text(angle=45,vjust=0.5))+
  labs(
    title="主樣本的生活快樂感和生活過得好不好",
    x="主樣本出生年度",y="平均分數",
    caption = "(1分最低，7分最高)")->graph$happylife
###d6 
d6 %>%
  ggplot(aes(x=scale, y=count, group=category, color=category))+
  geom_line(linetype="solid", size=1)+
  geom_point(size=3)+
  geom_text(aes(label=count,
    vjust=1.5,hjust=1.2,alpha=1.2,
    fontface="bold"),
    show.legend = FALSE)+
  scale_x_discrete(labels=labelsx)+
  scale_color_discrete(
  labels=c("Health","Shealth"))+
  theme(text=element_text(size=10, family="Comic Sans MS"),
  axis.text.x=element_text(angle=45,vjust=0.5))+
  labs(
    title="主樣本和其伴侶的自評健康分數",
    x="主樣本出生年度",y="平均分數",
    caption = "(1分最低，5分最高)")->graph$health
###d11
d11 %>%
  ggplot(aes(x=scale, y=count, group=category, color=category))+
  geom_line(linetype="solid", size=1)+
  geom_point(size=3)+
  geom_text(aes(label=count,
    vjust=1.6,hjust=1,alpha=1.2,
    fontface="bold"),
    show.legend = FALSE)+
  scale_x_discrete(labels=labelsx)+
  scale_color_discrete(
  labels=c("Eco","Family","Marry","Work"))+
  theme(text=element_text(size=10, family="Comic Sans MS"),
  axis.text.x=element_text(angle=45,vjust=0.5))+
  labs(
  title=
    "主樣本的工作、家庭、經濟、婚姻滿意度分數",
      x="主樣本出生年度",y="平均分數",
        caption="(1分最低，4分最高)")->graph$satisfaction
    
save(graph, file="psfdPlot.Rda")
```{r}
bookdown::publish_book()
```